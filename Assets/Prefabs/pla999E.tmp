[gd_scene load_steps=62 format=3 uid="uid://d0u2g2ybwrr02"]

[ext_resource type="Script" path="res://Scripts/PlayerController/PlayerCharacter.gd" id="1_ydshd"]
[ext_resource type="Texture2D" uid="uid://bmlbof84l3x3c" path="res://Sprites/Characters/n_sprite_character.png" id="2_dqccm"]
[ext_resource type="Texture2D" uid="uid://bxebnimufc1" path="res://Sprites/Characters/n_sprite_character_roll.png" id="3_gaxww"]
[ext_resource type="Script" path="res://Scripts/PlayerController/InputManager.gd" id="4_3vk6v"]
[ext_resource type="Script" path="res://Scripts/Tools/StateMachine_v2.gd" id="5_n5so8"]
[ext_resource type="Script" path="res://Scripts/Tools/AnimationManager_v2.gd" id="6_qtsa8"]
[ext_resource type="PackedScene" uid="uid://oa8fw4qtcfsf" path="res://Prefabs/weapon.tscn" id="7_avkv0"]
[ext_resource type="Resource" uid="uid://crwirbvd8pxh5" path="res://Ressources/W_WoodSword.tres" id="8_f164c"]
[ext_resource type="Script" path="res://Scripts/PlayerController/RayCastInteract.gd" id="9_3exfu"]
[ext_resource type="Script" path="res://Scripts/Tools/HealthSystem.gd" id="10_vuxjv"]

[sub_resource type="SphereShape3D" id="SphereShape3D_f46is"]
radius = 0.236637

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_l48ms"]
radius = 0.157194
height = 0.483084

[sub_resource type="AtlasTexture" id="AtlasTexture_cstc5"]
atlas = ExtResource("2_dqccm")
region = Rect2(0, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_7pfki"]
atlas = ExtResource("2_dqccm")
region = Rect2(11, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_keig8"]
atlas = ExtResource("2_dqccm")
region = Rect2(22, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_0vhyg"]
atlas = ExtResource("2_dqccm")
region = Rect2(33, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_f3c8r"]
atlas = ExtResource("2_dqccm")
region = Rect2(44, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_7152p"]
atlas = ExtResource("2_dqccm")
region = Rect2(55, 0, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_qmkod"]
atlas = ExtResource("3_gaxww")
region = Rect2(0, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_8ndds"]
atlas = ExtResource("3_gaxww")
region = Rect2(47, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_2iym4"]
atlas = ExtResource("3_gaxww")
region = Rect2(94, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_ctj77"]
atlas = ExtResource("3_gaxww")
region = Rect2(141, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_7qvef"]
atlas = ExtResource("3_gaxww")
region = Rect2(188, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_ufxqh"]
atlas = ExtResource("3_gaxww")
region = Rect2(235, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_cfuh7"]
atlas = ExtResource("3_gaxww")
region = Rect2(282, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_1rjfj"]
atlas = ExtResource("3_gaxww")
region = Rect2(329, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_2nnwl"]
atlas = ExtResource("3_gaxww")
region = Rect2(376, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_euf1s"]
atlas = ExtResource("3_gaxww")
region = Rect2(423, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_r7ykt"]
atlas = ExtResource("3_gaxww")
region = Rect2(470, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_ll5ky"]
atlas = ExtResource("3_gaxww")
region = Rect2(517, 0, 47, 48)

[sub_resource type="AtlasTexture" id="AtlasTexture_nn14i"]
atlas = ExtResource("2_dqccm")
region = Rect2(0, 17, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_kvtg6"]
atlas = ExtResource("2_dqccm")
region = Rect2(11, 17, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_mft6j"]
atlas = ExtResource("2_dqccm")
region = Rect2(22, 17, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_a8auo"]
atlas = ExtResource("2_dqccm")
region = Rect2(33, 17, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_5mpc6"]
atlas = ExtResource("2_dqccm")
region = Rect2(44, 17, 11, 17)

[sub_resource type="AtlasTexture" id="AtlasTexture_nvq4c"]
atlas = ExtResource("2_dqccm")
region = Rect2(55, 17, 11, 17)

[sub_resource type="SpriteFrames" id="SpriteFrames_g7ngw"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_cstc5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7pfki")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_keig8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0vhyg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_f3c8r")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7152p")
}],
"loop": true,
"name": &"Idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_qmkod")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8ndds")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2iym4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ctj77")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7qvef")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ufxqh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cfuh7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1rjfj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2nnwl")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_euf1s")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_r7ykt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ll5ky")
}],
"loop": true,
"name": &"Roll",
"speed": 15.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_nn14i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kvtg6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mft6j")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_a8auo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5mpc6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nvq4c")
}],
"loop": true,
"name": &"Run",
"speed": 5.0
}]

[sub_resource type="Animation" id="Animation_1lmgd"]
resource_name = "IdleL"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Idle"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_i3cxg"]
resource_name = "IdleR"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Idle"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6, 0.8, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_pwugx"]
resource_name = "RollL"
length = 0.7
step = 0.01
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Roll"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.06, 0.12, 0.18, 0.24, 0.32, 0.38, 0.44, 0.5, 0.57, 0.63),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_ss0lh"]
resource_name = "RollR"
length = 0.7
step = 0.01
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Roll"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.06, 0.12, 0.18, 0.24, 0.32, 0.38, 0.44, 0.5, 0.58, 0.64),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_kabxc"]
resource_name = "WalkL"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Run"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_w5k8h"]
resource_name = "WalkR"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../AnimatedSprite3D:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"Run"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AnimatedSprite3D:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../AnimatedSprite3D:flip_h")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_5dexs"]
_data = {
"IdleL": SubResource("Animation_1lmgd"),
"IdleR": SubResource("Animation_i3cxg"),
"RollL": SubResource("Animation_pwugx"),
"RollR": SubResource("Animation_ss0lh"),
"WalkL": SubResource("Animation_kabxc"),
"WalkR": SubResource("Animation_w5k8h")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_lork5"]
animation = &"IdleL"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ngpmb"]
animation = &"IdleR"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_lrh06"]
blend_point_0/node = SubResource("AnimationNodeAnimation_lork5")
blend_point_0/pos = -1.0
blend_point_1/node = SubResource("AnimationNodeAnimation_ngpmb")
blend_point_1/pos = 1.0
blend_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_h3056"]
animation = &"RollL"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_3ktef"]
animation = &"RollR"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_vn4jy"]
blend_point_0/node = SubResource("AnimationNodeAnimation_h3056")
blend_point_0/pos = -1.0
blend_point_1/node = SubResource("AnimationNodeAnimation_3ktef")
blend_point_1/pos = 1.0
blend_mode = 1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0yr4c"]
animation = &"WalkL"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_pg8yf"]
animation = &"WalkR"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_w7v1d"]
blend_point_0/node = SubResource("AnimationNodeAnimation_0yr4c")
blend_point_0/pos = -1.0
blend_point_1/node = SubResource("AnimationNodeAnimation_pg8yf")
blend_point_1/pos = 1.0
blend_mode = 1

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_0be1o"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_wfij8"]
advance_mode = 2
advance_condition = &"isRoll"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_26dd6"]
advance_mode = 2
advance_condition = &"isMoving"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8q6ay"]
switch_mode = 2
advance_mode = 2
advance_condition = &"isIdle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_nho6y"]
switch_mode = 2
advance_mode = 2
advance_condition = &"isMoving"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_b6i26"]
advance_mode = 2
advance_condition = &"isRoll"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_53v26"]
advance_mode = 2
advance_condition = &"isIdle"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_cmi6b"]
states/Idle/node = SubResource("AnimationNodeBlendSpace1D_lrh06")
states/Idle/position = Vector2(334, 102)
states/Roll/node = SubResource("AnimationNodeBlendSpace1D_vn4jy")
states/Roll/position = Vector2(334, 222)
states/Walk/node = SubResource("AnimationNodeBlendSpace1D_w7v1d")
states/Walk/position = Vector2(504, 100)
transitions = ["Start", "Idle", SubResource("AnimationNodeStateMachineTransition_0be1o"), "Idle", "Roll", SubResource("AnimationNodeStateMachineTransition_wfij8"), "Idle", "Walk", SubResource("AnimationNodeStateMachineTransition_26dd6"), "Roll", "Idle", SubResource("AnimationNodeStateMachineTransition_8q6ay"), "Roll", "Walk", SubResource("AnimationNodeStateMachineTransition_nho6y"), "Walk", "Roll", SubResource("AnimationNodeStateMachineTransition_b6i26"), "Walk", "Idle", SubResource("AnimationNodeStateMachineTransition_53v26")]

[node name="Player" type="CharacterBody3D"]
collision_layer = 3
script = ExtResource("1_ydshd")
SPEED = 1.5

[node name="Area3D" type="Area3D" parent="."]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Area3D"]
shape = SubResource("SphereShape3D_f46is")

[node name="CollisionBox" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_l48ms")

[node name="AnimatedSprite3D" type="AnimatedSprite3D" parent="."]
transform = Transform3D(2.5, 0, 0, 0, 1.76777, 1.76777, 0, -1.76777, 1.76777, 0, 0, 0)
flip_h = true
alpha_cut = 2
texture_filter = 0
sprite_frames = SubResource("SpriteFrames_g7ngw")
animation = &"Idle"
frame = 2

[node name="InputManager" type="Node" parent="." node_paths=PackedStringArray("_playerCharacter")]
script = ExtResource("4_3vk6v")
_playerCharacter = NodePath("..")

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("_animationTree")]
script = ExtResource("5_n5so8")
_animationTree = NodePath("../AnimationManager/AnimationTree")

[node name="AnimationManager" type="Node" parent="." node_paths=PackedStringArray("_character", "_animationTree")]
script = ExtResource("6_qtsa8")
_character = NodePath("..")
_animationTree = NodePath("AnimationTree")

[node name="AnimationTree" type="AnimationTree" parent="AnimationManager"]
libraries = {
"": SubResource("AnimationLibrary_5dexs")
}
tree_root = SubResource("AnimationNodeStateMachine_cmi6b")
anim_player = NodePath("../AnimationPlayer")
parameters/conditions/isIdle = false
parameters/conditions/isMoving = false
parameters/conditions/isRoll = false
parameters/Idle/blend_position = 0.0
parameters/Roll/blend_position = 0
parameters/Walk/blend_position = 0

[node name="AnimationPlayer" type="AnimationPlayer" parent="AnimationManager"]
libraries = {
"": SubResource("AnimationLibrary_5dexs")
}

[node name="Weapon" parent="." node_paths=PackedStringArray("_owner") instance=ExtResource("7_avkv0")]
_owner = NodePath("..")
_weaponActualStats = ExtResource("8_f164c")

[node name="RayCastInteract" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 5, 0, 0, 0, 1, 0, 0, 0)
target_position = Vector3(0.6, 0, 0)
collision_mask = 3
script = ExtResource("9_3exfu")

[node name="HealthSystem" type="Node" parent="."]
script = ExtResource("10_vuxjv")
_baseHp = 100

[connection signal="Interact" from="InputManager" to="RayCastInteract" method="_on_input_manager_interact"]
[connection signal="AtkFinished" from="Weapon" to="StateMachine" method="_on_weapon_atk_finished"]
[connection signal="TakeDamage" from="HealthSystem" to="HealthSystem" method="_on_take_damage"]
